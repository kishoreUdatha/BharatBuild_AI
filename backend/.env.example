# ============================================================
# BharatBuild AI - Backend Environment Configuration
# ============================================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env with real credentials to git
#
# For LOCAL development:   cp .env.local .env
# For AWS production:      Values come from ECS Task Definition + Secrets Manager
# ============================================================

# ==========================================
# APPLICATION SETTINGS
# ==========================================
APP_NAME=BharatBuild AI
# "development" or "production"
ENVIRONMENT=development
# Set to "false" in production
DEBUG=true
# Generate with: openssl rand -hex 32
SECRET_KEY=your-secret-key-here-change-in-production
API_VERSION=v1

# Server Configuration
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
# Number of workers (production only, default: 1)
WORKERS=1

# ==========================================
# DATABASE CONFIGURATION
# ==========================================
# Local:  postgresql+asyncpg://user:pass@localhost:5432/dbname
# AWS:    postgresql+asyncpg://user:pass@rds-host.region.rds.amazonaws.com:5432/dbname
# SQLite: sqlite+aiosqlite:///./bharatbuild.db (local dev only)
DATABASE_URL=postgresql+asyncpg://bharatbuild:password@localhost:5432/bharatbuild_db
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=0
DB_ECHO=false
# Set to "true" to drop and recreate tables on startup (DANGER!)
RESET_DB=false

# ==========================================
# REDIS CONFIGURATION
# ==========================================
# Local:  redis://localhost:6379/0
# AWS:    redis://:password@master.elasticache-host.region.cache.amazonaws.com:6379/0
REDIS_URL=redis://localhost:6379/0
REDIS_CACHE_DB=1

# ==========================================
# CELERY (Background Tasks)
# ==========================================
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# Celery Task Limits (in seconds)
CELERY_TASK_TIME_LIMIT=3600
CELERY_TASK_SOFT_TIME_LIMIT=3000
CELERY_RESULT_EXPIRES=86400

# ==========================================
# CLAUDE AI CONFIGURATION
# ==========================================
ANTHROPIC_API_KEY=sk-ant-api03-your-key-here
ANTHROPIC_BASE_URL=
USE_MOCK_CLAUDE=false
CLAUDE_HAIKU_MODEL=claude-3-5-haiku-20241022
CLAUDE_SONNET_MODEL=claude-sonnet-4-20250514
CLAUDE_MAX_TOKENS=4096
CLAUDE_TEMPERATURE=0.7
USE_PLAIN_TEXT_RESPONSES=true

# ==========================================
# STORAGE CONFIGURATION
# ==========================================
# Storage mode options:
#   "local" - Store files on local filesystem (development)
#   "s3"    - Store files in AWS S3 (production)
#   "minio" - Store files in MinIO (S3-compatible, local dev)
STORAGE_MODE=local

# User Projects Directory (where generated projects are stored)
# Use an absolute path OUTSIDE the BharatBuild_AI project folder
# Local:  C:/tmp/sandbox/workspace or /tmp/sandbox/workspace
# AWS:    /tmp/projects (ephemeral ECS storage, files go to S3)
USER_PROJECTS_PATH=C:/tmp/sandbox/workspace

# AWS S3 Configuration (for STORAGE_MODE=s3)
# In ECS/Fargate: Leave ACCESS_KEY and SECRET empty to use IAM role
# For local dev with S3: Provide explicit credentials
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=ap-south-1
# S3 bucket name (S3_BUCKET is alias for S3_BUCKET_NAME - either works)
S3_BUCKET_NAME=bharatbuild-projects
S3_BUCKET=

# MinIO Configuration (for STORAGE_MODE=minio)
MINIO_ENDPOINT=localhost:9000
USE_MINIO=false

# Storage URL Expiry (in seconds)
STORAGE_URL_EXPIRY=3600

# ==========================================
# AUTHENTICATION
# ==========================================
JWT_SECRET_KEY=your-jwt-secret-key-change-in-production
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# ==========================================
# GOOGLE OAUTH (Optional)
# ==========================================
# To set up Google OAuth:
# 1. Go to https://console.cloud.google.com/
# 2. Create a new project or select existing one
# 3. Go to "APIs & Services" > "Credentials"
# 4. Click "Create Credentials" > "OAuth client ID"
# 5. Select "Web application"
# 6. Add authorized redirect URIs (see GOOGLE_REDIRECT_URI below)
# 7. Copy the Client ID and Client Secret below
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URI=http://localhost:3000/auth/callback/google

# ==========================================
# GITHUB OAUTH (Optional)
# ==========================================
# To set up GitHub OAuth:
# 1. Go to https://github.com/settings/developers
# 2. Click "New OAuth App"
# 3. Set Homepage URL to: http://localhost:3000
# 4. Set Authorization callback URL (see GITHUB_REDIRECT_URI below)
# 5. Copy the Client ID and generate a Client Secret
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
GITHUB_REDIRECT_URI=http://localhost:3000/auth/callback/github

# ==========================================
# FRONTEND URL (for OAuth callbacks and CORS)
# ==========================================
FRONTEND_URL=http://localhost:3000
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws

# ==========================================
# RAZORPAY PAYMENT GATEWAY (Optional)
# ==========================================
RAZORPAY_KEY_ID=your-razorpay-key-id
RAZORPAY_KEY_SECRET=your-razorpay-key-secret
RAZORPAY_WEBHOOK_SECRET=your-razorpay-webhook-secret
PAYMENT_BASE_URL=https://payment.example.com

# ==========================================
# EMAIL CONFIGURATION (Optional)
# ==========================================
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
EMAIL_FROM=noreply@bharatbuild.ai
EMAIL_FROM_NAME=BharatBuild AI

# ==========================================
# CORS SETTINGS
# ==========================================
# Comma-separated list of allowed origins
CORS_ORIGINS_STR=http://localhost:3000,http://localhost:3001,http://localhost:3002

# ==========================================
# RATE LIMITING
# ==========================================
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_PER_HOUR=1000

# ==========================================
# FILE UPLOAD SETTINGS
# ==========================================
MAX_UPLOAD_SIZE=52428800
ALLOWED_EXTENSIONS_STR=pdf,doc,docx,txt,png,jpg,jpeg

# ==========================================
# LOGGING
# ==========================================
LOG_LEVEL=INFO
LOG_FILE=logs/app.log

# ==========================================
# TOKEN SYSTEM CONFIGURATION
# ==========================================
# Free Tier Settings
FREE_TIER_TOKENS=10000
FREE_TIER_MONTHLY_ALLOWANCE=10000

# Token Limits
MAX_TOKENS_PER_REQUEST=8192
MAX_REQUESTS_PER_DAY=100

# Mock Token Data (for development without auth)
DEV_MOCK_TOTAL_TOKENS=100000
DEV_MOCK_USED_TOKENS=5000
DEV_MOCK_MONTHLY_ALLOWANCE=50000

# Token Packages (format: tokens,price_in_paise,name)
TOKEN_PACKAGE_STARTER=50000,9900,Starter Pack
TOKEN_PACKAGE_PRO=200000,34900,Pro Pack
TOKEN_PACKAGE_UNLIMITED=1000000,149900,Unlimited Pack

# Monthly Plans (format: tokens_per_month,price,name)
MONTHLY_PLAN_FREE=10000,0,Free Tier
MONTHLY_PLAN_BASIC=50000,29900,Basic
MONTHLY_PLAN_PRO=250000,99900,Pro

# ==========================================
# PROMO CODES (Optional - better stored in database)
# ==========================================
# Format: CODE=tokens (comma-separated)
PROMO_CODES=WELCOME2024:10000,LAUNCH50:50000,BETA100:100000

# ==========================================
# CONTAINER EXECUTION (Docker Sandbox)
# ==========================================
CONTAINER_MEMORY_LIMIT=512m
CONTAINER_CPU_LIMIT=0.5
CONTAINER_CPU_PERIOD=100000
CONTAINER_CPU_QUOTA=50000
DEFAULT_CONTAINER_PORT=3000
BACKEND_DEFAULT_PORT=8001
CONTAINER_PORT_RANGE_START=10000
CONTAINER_MAX_LIFETIME=86400
CONTAINER_COMMAND_TIMEOUT=300

# ==========================================
# HEALTH MONITOR SETTINGS
# ==========================================
HEALTH_RESTART_DELAY=5
HEALTH_RESET_AFTER=300
HEALTH_CHECK_INTERVAL=30
HEALTH_MAX_FAILURES=3

# ==========================================
# CACHE TTL SETTINGS (in seconds)
# ==========================================
CACHE_TTL_PROJECT_META=3600
CACHE_TTL_PROJECT_FILES=900
CACHE_TTL_FILE_CONTENT=300
CACHE_TTL_USER_SESSION=1800

# ==========================================
# SESSION STORAGE SETTINGS
# ==========================================
SESSION_TTL_SECONDS=3600
SESSION_CLEANUP_INTERVAL=300

# ==========================================
# FILE STORAGE SETTINGS
# ==========================================
# Files below this size (bytes) are stored inline in PostgreSQL
FILE_INLINE_THRESHOLD=10240
# Max concurrent file operations for parallel saves
MAX_CONCURRENT_FILE_OPS=10

# ==========================================
# AGENT SETTINGS
# ==========================================
AGENT_BATCH_SIZE=3
AGENT_MAX_RETRIES=3
AGENT_MAX_AUTO_FIXES=3

# ==========================================
# TIMEOUTS AND INTERVALS (in seconds)
# ==========================================
SESSION_TTL=3600
CACHE_TTL=3600
API_REQUEST_TIMEOUT=30
HEALTH_CHECK_TIMEOUT=5
RECONNECTION_MAX_RETRIES=5
RECONNECTION_BASE_DELAY=1000
HEARTBEAT_INTERVAL=30000

# ==========================================
# BUFFER SIZES
# ==========================================
MAX_BUFFER_SIZE=50000
MAX_CONTEXT_TOKENS=50000

# ==========================================
# API KEY SETTINGS
# ==========================================
API_KEY_RATE_LIMIT_PER_DAY=10000

# ==========================================
# AGENTIC DEFAULTS
# ==========================================
DEFAULT_AI_MODEL=sonnet
DEFAULT_MAX_RESPONSE_TOKENS=8192

# ==========================================
# DOMAIN CONFIGURATION (for production)
# ==========================================
APP_DOMAIN=bharatbuild.ai
SHARE_URL_BASE=https://bharatbuild.ai/share

# ==========================================
# PROJECT CLEANUP
# ==========================================
PROJECT_CLEANUP_DAYS=7

# ==========================================
# SANDBOX CLEANUP (Bolt.new Style Ephemeral Storage)
# ==========================================
# Path where ephemeral project sandboxes are stored
SANDBOX_PATH=C:/tmp/sandbox/workspace

# Delete projects that are idle for longer than this (minutes)
# Bolt.new uses ~30 minutes, adjust as needed
SANDBOX_IDLE_TIMEOUT_MINUTES=30

# How often to run cleanup (minutes)
SANDBOX_CLEANUP_INTERVAL_MINUTES=5

# Don't delete projects younger than this (minutes)
SANDBOX_MIN_AGE_MINUTES=5

# Enable/disable automatic cleanup
SANDBOX_CLEANUP_ENABLED=true

# ==========================================
# PROJECT COMPLEXITY FILE LIMITS
# Override defaults from agent_config.yml
# ==========================================
# File limits by complexity level
FILE_LIMIT_MINIMAL=5
FILE_LIMIT_SIMPLE=8
FILE_LIMIT_INTERMEDIATE=15
FILE_LIMIT_INTERMEDIATE_BACKEND=20
FILE_LIMIT_COMPLEX=40

# Technology-specific limits
FILE_LIMIT_FLUTTER_SIMPLE=20
FILE_LIMIT_FLUTTER_COMPLEX=40
FILE_LIMIT_SPRING_BOOT_SIMPLE=20
FILE_LIMIT_SPRING_BOOT_COMPLEX=50
FILE_LIMIT_DJANGO_SIMPLE=18
FILE_LIMIT_DJANGO_COMPLEX=35
FILE_LIMIT_AI_ML=18

# ==========================================
# SANDBOX DOCKER HOST
# ==========================================
# Local (Docker Desktop): unix:///var/run/docker.sock or tcp://localhost:2375
# AWS ECS: tcp://sandbox-host-private-ip:2375
SANDBOX_DOCKER_HOST=unix:///var/run/docker.sock
# Preview URL base for sandbox applications
# Local: http://localhost:3001
# AWS:   http://alb-host.elb.amazonaws.com/sandbox
SANDBOX_PREVIEW_BASE_URL=http://localhost:3001

# ==========================================
# NOTES
# ==========================================
# 1. Never commit this file to git with real credentials
# 2. For production, use strong random values for SECRET_KEY and JWT_SECRET_KEY
# 3. For S3 storage, create AWS account and S3 bucket first
# 4. For local development, STORAGE_MODE=local is recommended
# 5. Token packages and promo codes should ideally be stored in database for production
#
# ==========================================
# QUICK START GUIDE
# ==========================================
# LOCAL DEVELOPMENT:
#   1. cp .env.local .env
#   2. Update ANTHROPIC_API_KEY with your key
#   3. Update DATABASE_URL if using different PostgreSQL credentials
#   4. Run: uvicorn app.main:app --reload
#
# AWS PRODUCTION:
#   1. Values come from ECS Task Definition environment variables
#   2. Secrets (API keys, passwords) come from AWS Secrets Manager
#   3. IAM role provides S3 access (no explicit AWS credentials needed)
#   4. See clean-taskdef.json for ECS task definition template
